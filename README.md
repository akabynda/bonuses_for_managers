# Анализ данных и расчет бонусов менеджеров

## Описание

Этот проект предназначен для анализа данных о продажах и расчета бонусов менеджеров за определенный период. Он включает в себя обработку данных из Excel-файла, фильтрацию и анализ сделок, а также расчет бонусов в соответствии с заданными условиями.

## Техническое задание

### Поля данных:
- `client_id` - ID клиента;
- `sum` – сумма денежных средств;
- `status` – статус оплаты;
- `sale` – менеджер, заключивший сделку;
- `new/current` – статус сделки;
- `document` – наличие оригинала подписанного договора с клиентом;
- `receiving_date` – дата получения оригинала договора.

### Вопросы для анализа:
1. Вычислите общую выручку за июль 2021 по тем сделкам, приход денежных средств которых не просрочен.
2. Как изменялась выручка компании за рассматриваемый период? Проиллюстрируйте графиком.
3. Кто из менеджеров привлек для компании больше всего денежных средств в сентябре 2021?
4. Какой тип сделок (новая/текущая) был преобладающим в октябре 2021?
5. Сколько оригиналов договора по майским сделкам было получено в июне 2021?

### Расчет бонусов:
1. За новые сделки менеджер получает 7% от суммы, при условии, что статус оплаты «ОПЛАЧЕНО», а также имеется оригинал подписанного договора с клиентом (в рассматриваемом месяце).
2. За текущие сделки менеджер получает 5% от суммы, если она больше 10 тыс., и 3% от суммы, если меньше. При этом статус оплаты может быть любым, кроме «ПРОСРОЧЕНО», а также необходимо наличие оригинала подписанного договора с клиентом (в рассматриваемом месяце).
3. Бонусы по сделкам, оригиналы для которых приходят позже рассматриваемого месяца, считаются остатком на следующий период, который выплачивается по мере прихода оригиналов.

### Результаты

#### Остаток бонусов каждого менеджера на 01.07.2021:
```plaintext
  Менеджер  Остаток бонусов на 01.07.2021
   Андреев                      4798.2037
  Васильев                       339.2310
    Иванов                      2503.8390
 Кузнецова                      2604.6716
   Петрова                      6522.1170
 Селиванов                       353.3220
   Смирнов                      4078.7240
Филимонова                       409.6830
```

#### Результаты анализа данных:
```plaintext
Общая выручка за июль 2021 (не просроченные сделки): 757830.74
Менеджер, привлекший больше всего денежных средств в сентябре 2021: Петрова - 219240.12
Преобладающий тип сделок в октябре 2021: текущая - 105
Количество оригиналов договора, полученных в июне 2021 по майским сделкам: 0
```

## Основные шаги

### 1. Загрузка и очистка данных

Загрузка данных из Excel-файла и удаление ненужных столбцов:

```python
data = pd.read_excel(file_path)
data = data.drop(columns=['Unnamed: 5'])
data['receiving_date'] = pd.to_datetime(data['receiving_date'], errors='coerce')
data['year'] = data['receiving_date'].dt.year
data['month'] = data['receiving_date'].dt.month
```

### 2. Фильтрация сделок до 01.07.2021

Фильтрация данных для отбора сделок, заключенных до июля 2021 года:

```python
eligible_deals = data[(data['year'] < 2021) | ((data['year'] == 2021) & (data['month'] < 7))].copy()
```

### 3. Определение функции для расчета бонусов

Функция для расчета бонусов менеджеров в зависимости от типа сделки и статуса оплаты:

```python
def calculate_bonus(row):
    if row['document'] == 'оригинал':
        if row['new/current'] == 'новая' и row['status'] == 'ОПЛАЧЕНО':
            return row['sum'] * 0.07
        elif row['new/current'] == 'текущая' и row['status'] != 'ПРОСРОЧЕНО':
            return row['sum'] * 0.05 if row['sum'] > 10000 else row['sum'] * 0.03
    return 0
```

### 4. Применение функции расчета бонусов

Применение функции ко всем отобранным сделкам и создание нового столбца с расчетными бонусами:

```python
eligible_deals['bonus'] = eligible_deals.apply(calculate_bonus, axis=1)
```

### 5. Фильтрация сделок с поздним получением оригиналов

Фильтрация сделок, для которых оригиналы договоров были получены позже даты заключения сделки:

```python
delayed_contracts = eligible_deals[eligible_deals['receiving_date'] > pd.to_datetime(eligible_deals[['year', 'month']].assign(day=1))]
```

### 6. Группировка по менеджерам и суммирование бонусов

Группировка данных по менеджерам и суммирование бонусов:

```python
bonuses_by_manager = delayed_contracts.groupby('sale')['bonus'].sum().reset_index()
bonuses_by_manager.columns = ['Менеджер', 'Остаток бонусов на 01.07.2021']
```

### 7. Вывод результатов

Вывод результатов в удобочитаемом формате:

```python
print("Остаток бонусов каждого менеджера на 01.07.2021:")
print("=" * 50)
print(bonuses_by_manager.to_string(index=False))
print("=" * 50)
```

## Использование

1. Убедитесь, что файл `data.xlsx` находится в той же директории, что и скрипты.
2. Запустите скрипт `bonuses.py` для расчета бонусов менеджеров.
3. Результаты будут выведены в консоль в удобочитаемом формате.

## Требования

Установите необходимые библиотеки с помощью команды:

```sh
pip install -r requirements.txt
```